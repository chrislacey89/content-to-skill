---
import {
	hero,
	problem,
	pipeline,
	install,
	benchmark,
	plugin,
} from "../../lib/content";
---

<div class="design-panel" data-design="18">
	<!-- Hero -->
	<section class="min-h-[80vh] flex items-center justify-center px-6 py-24">
		<div class="max-w-2xl mx-auto text-center">
			<p
				class="text-xs uppercase tracking-[0.3em] mb-6"
				style="font-family: 'Old Standard TT', serif; color: #a89070;"
			>
				Claude Code Plugin
			</p>
			<h1
				class="text-6xl sm:text-7xl font-normal mb-6 leading-[1.1]"
				style="font-family: 'Lora', serif; color: #f5f0e8;"
			>
				{hero.title}
			</h1>
			<p
				class="text-xl sm:text-2xl mb-8 leading-relaxed"
				style="font-family: 'Lora', serif; color: #c2532d;"
			>
				{hero.tagline}
			</p>
			<p
				class="text-base leading-relaxed max-w-lg mx-auto"
				style="font-family: 'Old Standard TT', serif; color: #a89070;"
			>
				{hero.description}
			</p>
		</div>
	</section>

	<!-- Divider -->
	<div class="max-w-2xl mx-auto px-6">
		<hr style="border-color: rgba(162, 144, 112, 0.2);" />
	</div>

	<!-- Chapter I: The Problem -->
	<section class="px-6 py-20">
		<div class="max-w-2xl mx-auto">
			<p
				class="text-xs uppercase tracking-[0.3em] mb-2"
				style="font-family: 'Old Standard TT', serif; color: #6b5c4a;"
			>
				Chapter I
			</p>
			<h2
				class="text-3xl mb-8"
				style="font-family: 'Lora', serif; color: #f5f0e8;"
			>
				The Problem
			</h2>
			<p
				class="text-lg leading-relaxed mb-8"
				style="font-family: 'Old Standard TT', serif; color: #a89070;"
			>
				{problem.text}
			</p>
		</div>
	</section>

	<!-- Chapter II: The Solution -->
	<section class="px-6 py-20">
		<div class="max-w-2xl mx-auto">
			<p
				class="text-xs uppercase tracking-[0.3em] mb-2"
				style="font-family: 'Old Standard TT', serif; color: #6b5c4a;"
			>
				Chapter II
			</p>
			<h2
				class="text-3xl mb-8"
				style="font-family: 'Lora', serif; color: #f5f0e8;"
			>
				The Solution
			</h2>
			<p
				class="text-lg leading-relaxed"
				style="font-family: 'Old Standard TT', serif; color: #a89070;"
			>
				{problem.solution}
			</p>
		</div>
	</section>

	<!-- Divider -->
	<div class="max-w-2xl mx-auto px-6">
		<hr style="border-color: rgba(162, 144, 112, 0.2);" />
	</div>

	<!-- Chapter III: How It Works (Pipeline) -->
	<section class="pipeline-section px-6 py-20">
		<div class="max-w-2xl mx-auto">
			<p
				class="text-xs uppercase tracking-[0.3em] mb-2"
				style="font-family: 'Old Standard TT', serif; color: #6b5c4a;"
			>
				Chapter III
			</p>
			<h2
				class="text-3xl mb-12"
				style="font-family: 'Lora', serif; color: #f5f0e8;"
			>
				How It Works
			</h2>

			<!-- Animated vertical pipeline -->
			<div class="pipeline-flow relative pl-10">
				<!-- Vertical line -->
				<div
					class="pipeline-line absolute left-[11px] top-0 bottom-0 w-px"
					style="background: rgba(194, 83, 45, 0.25); transform-origin: top; opacity: 0; transform: scaleY(0);"
				>
				</div>

				<!-- Pulse dot -->
				<div
					class="pipeline-pulse absolute left-[5px] w-[13px] h-[13px] rounded-full"
					style="background: #c2532d; box-shadow: 0 0 12px rgba(194, 83, 45, 0.5), 0 0 4px rgba(194, 83, 45, 0.8); top: 0; opacity: 0;"
				>
				</div>

				{
					pipeline.map((step) => (
						<div
							class="pipeline-step relative pb-10 last:pb-0 opacity-0"
							data-step={step.step}
						>
							{/* Node circle */}
							<div
								class="pipeline-node absolute left-[-34px] top-[3px] w-[23px] h-[23px] rounded-full border-2 flex items-center justify-center"
								style="border-color: rgba(194, 83, 45, 0.4); background: transparent;"
							>
								<div
									class="pipeline-node-inner w-[9px] h-[9px] rounded-full opacity-0"
									style="background: #c2532d;"
								/>
							</div>

							{/* Step content */}
							<div>
								<div class="flex items-baseline gap-3 mb-1">
									<span
										class="text-sm"
										style="font-family: 'Lora', serif; color: #6b5c4a;"
									>
										{step.step}
									</span>
									<h3
										class="text-lg pipeline-step-name"
										style="font-family: 'Lora', serif; color: #d4c4a8;"
									>
										{step.name}
									</h3>
								</div>
								<p
									class="text-sm leading-relaxed pipeline-step-desc"
									style="font-family: 'Old Standard TT', serif; color: #7a6b58;"
								>
									{step.description}
								</p>
							</div>
						</div>
					))
				}
			</div>
		</div>
	</section>

	<!-- Divider -->
	<div class="max-w-2xl mx-auto px-6">
		<hr style="border-color: rgba(162, 144, 112, 0.2);" />
	</div>

	<!-- Benchmark -->
	<section class="px-6 py-20">
		<div class="max-w-2xl mx-auto">
			<p
				class="text-xs uppercase tracking-[0.3em] mb-2"
				style="font-family: 'Old Standard TT', serif; color: #6b5c4a;"
			>
				Benchmark
			</p>
			<h3
				class="text-xl mb-6"
				style="font-family: 'Lora', serif; color: #f5f0e8;"
			>
				{benchmark.book}
			</h3>
			<div
				class="grid grid-cols-2 sm:grid-cols-3 gap-6"
				style="font-family: 'Old Standard TT', serif;"
			>
				<div>
					<p class="text-xs uppercase tracking-wider mb-1" style="color: #6b5c4a;">
						Pages
					</p>
					<p style="color: #d4c4a8;">{benchmark.pages}</p>
				</div>
				<div>
					<p class="text-xs uppercase tracking-wider mb-1" style="color: #6b5c4a;">
						Time
					</p>
					<p style="color: #d4c4a8;">{benchmark.time}</p>
				</div>
				<div>
					<p class="text-xs uppercase tracking-wider mb-1" style="color: #6b5c4a;">
						Cost
					</p>
					<p style="color: #d4c4a8;">{benchmark.cost}</p>
				</div>
				<div>
					<p class="text-xs uppercase tracking-wider mb-1" style="color: #6b5c4a;">
						Input Tokens
					</p>
					<p style="color: #d4c4a8;">{benchmark.inputTokens}</p>
				</div>
				<div>
					<p class="text-xs uppercase tracking-wider mb-1" style="color: #6b5c4a;">
						Output Tokens
					</p>
					<p style="color: #d4c4a8;">{benchmark.outputTokens}</p>
				</div>
				<div>
					<p class="text-xs uppercase tracking-wider mb-1" style="color: #6b5c4a;">
						Output
					</p>
					<p style="color: #d4c4a8;">{benchmark.output}</p>
				</div>
			</div>
		</div>
	</section>

	<!-- Divider -->
	<div class="max-w-2xl mx-auto px-6">
		<hr style="border-color: rgba(162, 144, 112, 0.2);" />
	</div>

	<!-- Chapter IV: Get Started -->
	<section class="px-6 py-20">
		<div class="max-w-2xl mx-auto">
			<p
				class="text-xs uppercase tracking-[0.3em] mb-2"
				style="font-family: 'Old Standard TT', serif; color: #6b5c4a;"
			>
				Chapter IV
			</p>
			<h2
				class="text-3xl mb-8"
				style="font-family: 'Lora', serif; color: #f5f0e8;"
			>
				Get Started
			</h2>

			<!-- Prerequisites -->
			<p
				class="text-sm uppercase tracking-wider mb-3"
				style="font-family: 'Old Standard TT', serif; color: #6b5c4a;"
			>
				Prerequisites
			</p>
			<div class="flex gap-4 mb-10">
				{
					install.prerequisites.map((p) => (
						<span
							class="text-sm px-3 py-1 rounded"
							style="font-family: 'JetBrains Mono', monospace; color: #d4c4a8; background: rgba(162, 144, 112, 0.1); border: 1px solid rgba(162, 144, 112, 0.15);"
						>
							{p}
						</span>
					))
				}
			</div>

			<!-- Install commands -->
			<p
				class="text-sm uppercase tracking-wider mb-3"
				style="font-family: 'Old Standard TT', serif; color: #6b5c4a;"
			>
				Install
			</p>
			<div class="space-y-3 mb-10">
				{
					install.commands.map((cmd) => (
						<div>
							<p
								class="text-xs mb-1"
								style="font-family: 'Old Standard TT', serif; color: #6b5c4a;"
							>
								{cmd.label}
							</p>
							<div
								class="group relative px-4 py-3 rounded"
								style="background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(162, 144, 112, 0.1);"
							>
								<code
									class="text-sm"
									style="font-family: 'JetBrains Mono', monospace; color: #c2532d;"
								>
									{cmd.command}
								</code>
								<button
									class="copy-btn absolute right-3 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer"
									data-copy={cmd.command}
									style="color: #6b5c4a;"
								>
									<svg
										class="w-4 h-4"
										fill="none"
										stroke="currentColor"
										viewBox="0 0 24 24"
									>
										<path
											stroke-linecap="round"
											stroke-linejoin="round"
											stroke-width="2"
											d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
										/>
									</svg>
								</button>
							</div>
						</div>
					))
				}
			</div>

			<!-- Quick Start -->
			<p
				class="text-sm uppercase tracking-wider mb-3"
				style="font-family: 'Old Standard TT', serif; color: #6b5c4a;"
			>
				Quick Start
			</p>
			<div class="space-y-3">
				{
					install.quickStart.map((cmd, i) => (
						<div class="flex items-start gap-4">
							<span
								class="text-sm mt-3 shrink-0"
								style="font-family: 'Lora', serif; color: #6b5c4a;"
							>
								{i + 1}.
							</span>
							<div class="flex-1">
								<p
									class="text-xs mb-1"
									style="font-family: 'Old Standard TT', serif; color: #6b5c4a;"
								>
									{cmd.label}
								</p>
								<div
									class="group relative px-4 py-3 rounded"
									style="background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(162, 144, 112, 0.1);"
								>
									<code
										class="text-sm"
										style="font-family: 'JetBrains Mono', monospace; color: #c2532d;"
									>
										{cmd.command}
									</code>
									<button
										class="copy-btn absolute right-3 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer"
										data-copy={cmd.command}
										style="color: #6b5c4a;"
									>
										<svg
											class="w-4 h-4"
											fill="none"
											stroke="currentColor"
											viewBox="0 0 24 24"
										>
											<path
												stroke-linecap="round"
												stroke-linejoin="round"
												stroke-width="2"
												d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
											/>
										</svg>
									</button>
								</div>
							</div>
						</div>
					))
				}
			</div>
		</div>
	</section>

	<!-- Footer -->
	<footer class="px-6 py-12">
		<div class="max-w-2xl mx-auto text-center">
			<p class="text-xs" style="font-family: 'Old Standard TT', serif; color: #6b5c4a;">
				{plugin.name} v{plugin.version} &middot; {plugin.license} &middot;
				<a
					href={plugin.repository}
					target="_blank"
					rel="noopener"
					class="underline hover:no-underline"
					style="color: #a89070;"
				>
					GitHub
				</a>
			</p>
		</div>
	</footer>
</div>

<script>
	import { animate, inView, stagger } from "motion";

	function initPipeline() {
		const section = document.querySelector(".pipeline-section");
		if (!section) return;

		inView(
			section,
			() => {
				const steps = section.querySelectorAll<HTMLElement>(".pipeline-step");
				const pulse = section.querySelector<HTMLElement>(".pipeline-pulse");
				const nodes = section.querySelectorAll<HTMLElement>(".pipeline-node");
				const nodeInners =
					section.querySelectorAll<HTMLElement>(".pipeline-node-inner");
				const stepNames =
					section.querySelectorAll<HTMLElement>(".pipeline-step-name");
				const stepDescs =
					section.querySelectorAll<HTMLElement>(".pipeline-step-desc");
				const line = section.querySelector<HTMLElement>(".pipeline-line");

				const totalSteps = steps.length;
				const animations: { stop: () => void }[] = [];

				// Phase 1: Fade in the vertical line
				if (line) {
					animations.push(
						animate(
							line,
							{ opacity: [0, 1], scaleY: [0, 1] },
							{ duration: 0.6, ease: "ease-out" },
						),
					);
				}

				// Phase 2: Stagger step entries with a slide-up
				animations.push(
					animate(
						steps,
						{
							opacity: [0, 1],
							transform: ["translateY(24px)", "translateY(0)"],
						},
						{
							delay: stagger(0.12, { startDelay: 0.3 }),
							duration: 0.5,
							ease: [0.25, 0.46, 0.45, 0.94],
						},
					),
				);

				// Phase 3: Sequential node activation with pulse traveling down
				// Wait for steps to fully appear, then start the pulse cycle
				const startPulse = () => {
					if (!pulse) return;

					// Compute node positions relative to the pipeline-flow container
					const flowEl = section.querySelector<HTMLElement>(".pipeline-flow");
					if (!flowEl) return;
					const flowTop = flowEl.getBoundingClientRect().top;

					const nodePositions = Array.from(nodes).map((node) => {
						const rect = node.getBoundingClientRect();
						return rect.top - flowTop + rect.height / 2 - 6;
					});

					let currentCycle: { stop: () => void } | null = null;

					const runCycle = () => {
						// Reset all nodes to inactive
						nodeInners.forEach((inner) => {
							inner.style.opacity = "0";
							inner.style.transform = "scale(0)";
						});
						nodes.forEach((node) => {
							node.style.borderColor = "rgba(194, 83, 45, 0.4)";
						});
						stepNames.forEach((name) => {
							name.style.color = "#d4c4a8";
						});
						stepDescs.forEach((desc) => {
							desc.style.color = "#7a6b58";
						});

						// Build a sequence: pulse moves to each node, node activates
						type SequenceSegment =
							| [HTMLElement, Record<string, any>]
							| [
									HTMLElement,
									Record<string, any>,
									Record<string, any>,
								];
						const sequence: SequenceSegment[] = [];

						// Fade in pulse at first position
						pulse.style.top = `${nodePositions[0]}px`;
						sequence.push([
							pulse,
							{ opacity: [0, 1], scale: [0.5, 1] },
							{ duration: 0.3, at: 0 },
						]);

						for (let i = 0; i < totalSteps; i++) {
							const pos = nodePositions[i];
							const time = 0.3 + i * 0.6;

							// Move pulse to this node
							if (i > 0) {
								sequence.push([
									pulse,
									{ top: `${pos}px` },
									{
										duration: 0.4,
										ease: [0.33, 0, 0.67, 1],
										at: time,
									},
								]);
							}

							// Activate node: fill inner dot, brighten border
							sequence.push([
								nodeInners[i],
								{ opacity: [0, 1], transform: ["scale(0)", "scale(1)"] },
								{
									duration: 0.25,
									ease: [0.34, 1.56, 0.64, 1],
									at: time + 0.15,
								},
							]);
							sequence.push([
								nodes[i],
								{ borderColor: "#c2532d" },
								{ duration: 0.2, at: time + 0.15 },
							]);

							// Brighten text
							sequence.push([
								stepNames[i],
								{ color: "#f5f0e8" },
								{ duration: 0.25, at: time + 0.15 },
							]);
							sequence.push([
								stepDescs[i],
								{ color: "#a89070" },
								{ duration: 0.25, at: time + 0.15 },
							]);
						}

						// Hold at the end, then fade pulse out
						const endTime = 0.3 + totalSteps * 0.6 + 1.0;
						sequence.push([
							pulse,
							{ opacity: [1, 0], scale: [1, 1.5] },
							{ duration: 0.4, at: endTime },
						]);

						// Fade all nodes back to dim before restarting
						const resetTime = endTime + 0.6;
						for (let i = 0; i < totalSteps; i++) {
							sequence.push([
								nodeInners[i],
								{ opacity: 0, transform: "scale(0)" },
								{ duration: 0.3, at: resetTime },
							]);
							sequence.push([
								nodes[i],
								{ borderColor: "rgba(194, 83, 45, 0.4)" },
								{ duration: 0.3, at: resetTime },
							]);
							sequence.push([
								stepNames[i],
								{ color: "#d4c4a8" },
								{ duration: 0.3, at: resetTime },
							]);
							sequence.push([
								stepDescs[i],
								{ color: "#7a6b58" },
								{ duration: 0.3, at: resetTime },
							]);
						}

						currentCycle = animate(sequence as any);
						currentCycle
							.then(() => {
								// Small pause then loop
								setTimeout(runCycle, 800);
							})
							.catch(() => {
								/* stopped */
							});
					};

					// Begin first cycle after steps finish appearing
					const delayMs =
						(0.3 + totalSteps * 0.12 + 0.5) * 1000 + 200;
					const startTimeout = setTimeout(runCycle, delayMs);

					animations.push({
						stop: () => {
							clearTimeout(startTimeout);
							currentCycle?.stop();
						},
					});
				};

				startPulse();

				// Cleanup on leave: stop all animations, reset state
				return () => {
					animations.forEach((a) => a.stop());

					steps.forEach((step) => {
						step.style.opacity = "0";
						step.style.transform = "translateY(24px)";
					});
					if (pulse) {
						pulse.style.opacity = "0";
					}
					if (line) {
						line.style.opacity = "0";
						line.style.transform = "scaleY(0)";
					}
					nodeInners.forEach((inner) => {
						inner.style.opacity = "0";
						inner.style.transform = "scale(0)";
					});
					nodes.forEach((node) => {
						node.style.borderColor = "rgba(194, 83, 45, 0.4)";
					});
					stepNames.forEach((name) => {
						name.style.color = "#d4c4a8";
					});
					stepDescs.forEach((desc) => {
						desc.style.color = "#7a6b58";
					});
				};
			},
			{ amount: 0.2 },
		);
	}

	// Copy button handler
	function initCopyButtons() {
		document.querySelectorAll(".copy-btn").forEach((btn) => {
			btn.addEventListener("click", async () => {
				const text = btn.getAttribute("data-copy");
				if (text) {
					await navigator.clipboard.writeText(text);
					btn.classList.add("copied");
					setTimeout(() => btn.classList.remove("copied"), 1500);
				}
			});
		});
	}

	initPipeline();
	initCopyButtons();
</script>
